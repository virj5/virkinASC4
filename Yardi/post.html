<!DOCTYPE html>
<html lang="en">

  <head>
     <script src="https://apis.google.com/js/platform.js" async defer></script>
    <meta name="google-signin-client_id" content="403644835577-u68r8o67vod26eqdeiu3gdsv7sr33r1l.apps.googleusercontent.com">



    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Yardi</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- Custom styles for this template -->
    <link href="css/clean-blog.min.css" rel="stylesheet">

    <!-- Firebase -->
    
			<script src="https://www.gstatic.com/firebasejs/4.2.0/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyCFgW85GhKztCsK90-OOVMN3vuEOy5A_Lk",
    authDomain: "yardi-8fbf9.firebaseapp.com",
    databaseURL: "https://yardi-8fbf9.firebaseio.com",
    projectId: "yardi-8fbf9",
    storageBucket: "yardi-8fbf9.appspot.com",
    messagingSenderId: "196157085082"
  };
  firebase.initializeApp(config);
</script>
 <!-- JS for adding a party-->
	<script src = "/js/database.js"></script>
</script>

    <style>

      #map {
        height: 50%;
      }

      </style>
 <script>
      // Note: This example requires that you consent to location sharing when
      // prompted by your browser. If you see the error "The Geolocation service
      // failed.", it means you probably did not give permission for the browser to
      // locate you.
      var map, infoWindow;
      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: -34.397, lng: 150.644},
          zoom: 6
        });
        infoWindow = new google.maps.InfoWindow;
        // Try HTML5 geolocation.
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            var pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };
            infoWindow.setPosition(pos);
            infoWindow.setContent('Location found.');
            infoWindow.open(map);
            map.setCenter(pos);
          }, function() {
            handleLocationError(true, infoWindow, map.getCenter());
          });
        } else {
          // Browser doesn't support Geolocation
          handleLocationError(false, infoWindow, map.getCenter());
        }
      }
      function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                              'Error: The Geolocation service failed.' :
                              'Error: Your browser doesn\'t support geolocation.');
        infoWindow.open(map);
      }
    </script>
    
       <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCzUtkI2umg5tdd8stHoSMIEuOSLK_uyj4&callback=initMap">
    </script>
  </head>

  <body>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
      <a class="navbar-brand" href="#">Yardi</a>
      <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        Menu
        <i class="fa fa-bars"></i>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="index2.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="about.html">About</a>
          </li>
          <li class="nav-item">

            <!-- <a class="nav-link" href="post.html">Sign-In</a> -->
          </li>
          <!-- <li class="nav-item">
            <a class="nav-link" href="contact.html">Contact</a>
          </li> -->
        </ul>
      </div>
    </nav>

    <!-- Page Header -->
    <header class="masthead" style="background-image: url('img/10.jpg')">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-md-10 mx-auto">
            <div class="post-heading">
              <h1>Create your Own Party or Find those Nearby </h1>
              <h2 class="subheading">Find those around your current location</h2>
              <span class="meta">A new way and safe way of
                <a href="#">Partying</a>
                <!-- on August 24, 2017</span> -->
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Post Content -->
    <article>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-md-10 mx-auto">
            <h2 class="section-heading">Find or create parties while using Google Maps API!</h2>
            <div id="map"></div>
                <input id= "partyname"type="text" class="form-control" placeholder="Party Name" aria-describedby="basic-addon1">
<input id= "description" type="text" class="form-control" placeholder="Party Description" aria-describedby="basic-addon1">
<input id= "ticketlink"type="text" class="form-control" placeholder="Link to Eventbrite" aria-describedby="basic-addon1">
<input id = "address"type="text" class="form-control" placeholder="Address" aria-describedby="basic-addon1">
<input id = "agegroup"type="text" class="form-control" placeholder="Age Group" aria-describedby="basic-addon1">
<input type="reset" onclick="addParty();" value="Submit">
    <script>
      var map, infoWindow, andy;
      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: -34.397, lng: 150.644},
          zoom: 12
        });
        infoWindow = new google.maps.InfoWindow;
        // Try HTML5 geolocation.
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            var pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };
            infoWindow.setPosition(pos);
            infoWindow.setContent('Your Location');
            infoWindow.open(map);
            map.setCenter(pos);
          }, function() {
            handleLocationError(true, infoWindow, map.getCenter());
          });
        } else {
          // Browser doesn't support Geolocation
          handleLocationError(false, infoWindow, map.getCenter());
        }
      }
    var database = firebase.database().ref();
    function addParty(){
    var geoKey = "AIzaSyA0wxHfbgBC9oSjNh4mM_DYSOZoQzy37e8";
    
    var partyname = $("#partyname").val();
    var agegroup=$("#agegroup").val();
    var description = $("#description").val();
    var ticketlink = $("#ticketlink").val();
    var addressStore = $("#address").val();
    var  address= $("#address").val();
     var address = address.replace(/\s+/g, '+'); //Replaces spaces with +
     var cord = {}; 
     var latitude = "";
     var longitude = "";
    var googleurl = "https://maps.googleapis.com/maps/api/geocode/json?address="+address+"&key="+geoKey;
   $.ajax({
    url: googleurl,
    dataType: 'json',
    success: function(data) {
        var info = data.results[0];
         var coordinates = info.geometry.location;   
         useReturnData(coordinates);     
        }
    });
    function useReturnData(coordinates){
        cord = coordinates;
        latitude = cord.lat;
        longitude = cord.lng;
    var value={
        PARTYNAME: partyname,
        LAT: latitude,
        LONG: longitude,
        ADDRESS: addressStore,
        COORDINATES:cord,
        AGEGROUP:agegroup,
        DESCRIPTION: description,
        TICKETLINK: ticketlink
    }
        database.push(value); 
   
        
    var contentString = '<div id="content">'+
            '<div id="siteNotice">'+
            '</div>'+
            '<h2 id="firstHeading" class="firstHeading">'+partyname+'</h2>'+
            '<div id="bodyContent">'+
            '<p><b>Description: </b>'+ description+'</p>'
            + '<p><b>Address: </b> '+ addressStore +'</p>'
            + '<p><b>Ticket Link: </b> '+ ticketlink +'</p>'
            +
            '</div>'+
            '</div>';
    
    
     var marker = new google.maps.Marker({
         position: {lat: latitude, lng: longitude}, //coordinates of marker
         map: map,  // map where the marker is going
         title: partyname,  // Title of Marker
     });
    var partydetails = new google.maps.InfoWindow({
        position: {lat: latitude, lng: longitude},
        map: map,
        content: contentString
    })
    
     google.maps.event.addListener(marker, 'click', function() {
         // your magic goes here
         partydetails.open(map, marker);
     });
    }
database.on("child_added", function(rowData){
    var row = rowData.val();
    var partyname = row.PARTYNAME;
    var description = row.DESCRIPTION;
    var ticketlink = row.TICKETLINK;
    var latitude = row.LAT;
    var longitude = row.LONG;
    var addressStore = row.ADDRESS;
    var cord = row.COORDINATES;
    var agegroup = row.AGEGROUP;
    
}
)
}
</script>
            
												

												
					</div>
          </div>
        </div>
      </div>
    </article>

   

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/popper/popper.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>

    <!-- Custom scripts for this template -->
    <script src="js/clean-blog.min.js"></script>

  </body>

</html>
